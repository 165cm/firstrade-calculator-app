// src/data/faqData.ts
// チャットサポート用のFAQデータ

export interface FAQItem {
    id: string;
    category: string;
    question: string;
    answer: string;
    keywords: string[];
}

export const FAQ_DATA: FAQItem[] = [
    // ========================================
    // カテゴリ: はじめに（基本的な使い方）
    // ========================================
    {
        id: 'getting-started-1',
        category: 'はじめに',
        question: 'このツールは何ができますか？',
        answer: 'FirstScopeは、Firstrade証券の確定申告をサポートするツールです。主な機能は4つあります：\n\n1. 配当金明細: 配当金・利子の円換算と集計\n2. 売却損益: 株式売却益の計算\n3. 損益シミュレーター: 売却タイミングの税金シミュレーション\n4. ポートフォリオ分析: 保有銘柄の資産配分を可視化\n\nCSVファイルをアップロードするだけで、為替レート取得から円換算まで自動で行います。',
        keywords: ['機能', '何ができる', 'できること', '使い方', 'はじめて', '初めて']
    },
    {
        id: 'getting-started-2',
        category: 'はじめに',
        question: '無料で使える機能はありますか？',
        answer: 'はい、すべての機能（配当金、売却損益、シミュレーター、ポートフォリオ）を無料でお試しいただけます。\n\n画面上で計算結果やグラフを確認することは無料版でも可能です。\n\nCSVファイルのエクスポート機能を利用する場合のみ、有料ライセンスが必要になります。',
        keywords: ['無料', '試す', 'お試し', 'タダ', 'フリー', '体験']
    },
    {
        id: 'getting-started-3',
        category: 'はじめに',
        question: 'デモデータで試すにはどうすればいいですか？',
        answer: '各機能ページに「デモデータをインポート」ボタンがあります。\n\nこのボタンをクリックすると、サンプルデータが自動で読み込まれ、ツールの動作を確認できます。\n\n実際のCSVファイルを用意しなくても、機能をお試しいただけます。',
        keywords: ['デモ', 'サンプル', '試す', 'テスト', '動作確認']
    },

    // ========================================
    // カテゴリ: CSVファイルについて
    // ========================================
    {
        id: 'csv-1',
        category: 'CSVファイル',
        question: 'CSVファイルはどこからダウンロードできますか？',
        answer: 'Firstradeにログイン後、以下の場所からダウンロードできます：\n\n配当金CSV:\nAccounts → Tax Center → Dividend Income → Download CSV\n\n売却損益CSV:\nAccounts → Tax Center → Gain/Loss → Download CSV\n\n年度を選択してからダウンロードしてください。',
        keywords: ['CSV', 'ダウンロード', '取得', 'どこ', 'Firstrade', 'Tax Center']
    },
    {
        id: 'csv-2',
        category: 'CSVファイル',
        question: 'CSVファイルのアップロード方法は？',
        answer: '各機能ページのアップロードエリアに、2つの方法でファイルを追加できます：\n\n1. ドラッグ＆ドロップ: ファイルをエリアに直接ドラッグ\n2. クリックして選択: エリアをクリックしてファイルを選択\n\nアップロード後、自動的に為替レート取得と計算が始まります。',
        keywords: ['アップロード', '使い方', 'ファイル', 'ドラッグ', '追加']
    },
    {
        id: 'csv-3',
        category: 'CSVファイル',
        question: 'CSVファイルが読み込めません',
        answer: '以下を確認してください：\n\n1. ファイル形式: .csv形式になっていますか？\n2. ダウンロード元: Firstradeの Tax Center からダウンロードしたファイルですか？\n3. 文字コード: ファイルを開いて編集していませんか？（編集すると形式が崩れることがあります）\n\n解決しない場合は、お問い合わせフォームからご連絡ください。',
        keywords: ['読み込めない', 'エラー', '失敗', 'できない', '読み込み']
    },

    // ========================================
    // カテゴリ: 為替レートについて
    // ========================================
    {
        id: 'exchange-1',
        category: '為替レート',
        question: '為替レートはどこから取得していますか？',
        answer: '欧州中央銀行（ECB）が公表する為替レートを使用しています。\n\nFrankfurter APIというオープンソースサービスを通じて取得しており、信頼性と透明性が担保されています。\n\n税務調査時にも「ECBの公式レートを使用」と説明できます。',
        keywords: ['為替', 'レート', 'どこ', '取得', 'ECB', 'Frankfurter', '信頼性']
    },
    {
        id: 'exchange-2',
        category: '為替レート',
        question: 'デフォルト為替レートの警告が出ました',
        answer: '一部の日付で為替レートが取得できなかった場合、デフォルト値（約150円）が使用されます。\n\n対処方法:\n確定申告時には、三菱UFJ銀行等のTTM（仲値）を確認し、必要に応じて手動で修正してください。',
        keywords: ['デフォルト', '警告', '注意', '150円', 'レート']
    },
    {
        id: 'exchange-3',
        category: '為替レート',
        question: '為替レートを手動で変更できますか？',
        answer: '現在のバージョンでは、為替レートの手動修正機能はありません。\n\nエクスポートしたCSVファイルをExcel等で開き、必要に応じて為替レートの列を修正してください。\n\n将来のバージョンで対応を検討しています。',
        keywords: ['手動', '変更', '修正', '編集', 'レート変更']
    },
    {
        id: 'exchange-4',
        category: '為替レート',
        question: '為替レートはいつ更新されますか？',
        answer: '欧州中央銀行（ECB）の公表データに基づき、原則として平日の毎日更新されます。\n\n日本時間の深夜〜早朝に最新レートが反映されます。\n\n※土日・祝日は市場が休みのため、更新はありません（直近の平日レートが適用されます）。',
        keywords: ['更新', 'いつ', '頻度', '土曜', '週一', 'タイミング', '最新']
    },

    // ========================================
    // カテゴリ: ライセンスについて
    // ========================================
    {
        id: 'license-1',
        category: 'ライセンス',
        question: 'ライセンスの価格と有効期限は？',
        answer: 'ライセンスはGumroadにて販売しています。\n\n2025年版ライセンス:\n- 有効期限: 2026年末まで\n- 詳細な価格はGumroadのページでご確認ください\n\n「購入」ボタンからGumroadへ移動できます。',
        keywords: ['価格', '料金', '値段', 'いくら', '有効期限', 'ライセンス']
    },
    {
        id: 'license-2',
        category: 'ライセンス',
        question: 'ライセンスキーはどこで確認できますか？',
        answer: '購入完了後、Gumroadから送られるメールにライセンスキーが記載されています。\n\nメールが届かない場合は、Gumroadの購入履歴からも確認できます。\n\n迷惑メールフォルダも確認してください。',
        keywords: ['ライセンスキー', '確認', 'どこ', 'メール', '届かない']
    },
    {
        id: 'license-3',
        category: 'ライセンス',
        question: 'ライセンス認証がうまくいきません',
        answer: 'ライセンス認証でエラーが出る場合、以下を確認してください：\n\n1. 入力ミス: ライセンスキーをコピー＆ペーストで入力していますか？\n2. 有効期限: ライセンスの有効期限が切れていませんか？\n3. 接続: インターネット接続は安定していますか？\n\n解決しない場合は、お問い合わせください。',
        keywords: ['認証', 'エラー', 'できない', '失敗', 'ライセンス']
    },

    // ========================================
    // カテゴリ: 機能別の質問
    // ========================================
    {
        id: 'feature-dividend-1',
        category: '配当金明細',
        question: '源泉徴収額が表示されません',
        answer: '源泉徴収額の自動取得率は約73%です。\n\nこれはFirstradeのCSVデータ自体に源泉徴収額が記録されていないケースがあるためで、ツール側の不具合ではありません。\n\n対処方法:\n必ずFirstradeの月次明細（Statement）と照合し、不足分を手動で補完してください。',
        keywords: ['源泉徴収', '表示されない', '配当', '税金', '引かれ']
    },
    {
        id: 'feature-dividend-2',
        category: '配当金明細',
        question: '月次サマリーはどこで見れますか？',
        answer: 'CSVをアップロード後、画面下部に月ごとの集計と年間サマリーが自動表示されます。\n\n配当金、利子、源泉徴収額がそれぞれ月ごとにまとめられています。',
        keywords: ['月次', 'サマリー', '集計', '合計', '月ごと']
    },
    {
        id: 'feature-gainloss-2',
        category: '売却損益',
        question: '明細と損益が合いません（Wash Sale/損失不許可）',
        answer: '米国の「ウォッシュセール（Wash Sale）」ルールにより、損失が一時的に無効化されている可能性があります。\n\n本来、損失が出た株を30日以内に買い直すと、その損失は「なかったこと」にされ、次に売る時まで繰り延べられます。これが原因で、手元の計算より損失が少なく（利益が多く）見えることがあります。\n\n詳細な仕組みと、どちらの計算モード（米国方式/日本方式）を選ぶべきかについては、以下の解説ページをご覧ください。\n\n[Wash Saleの解説とモード選択について](/guide/washsale)',
        keywords: ['Wash Sale', 'ウォッシュセール', '損益', '合わない', '損失不許可', 'W', 'WS', '計算モード']
    },
    {
        id: 'feature-simulator-1',
        category: 'シミュレーター',
        question: 'シミュレーターの使い方を教えてください',
        answer: 'シミュレーターでは、Firstradeの画面から損益データをコピー＆ペーストするだけで計算できます。\n\n使い方:\n1. Firstradeで保有銘柄の損益を表示\n2. データをコピー\n3. シミュレーターの入力欄にペースト\n4. 「計算」ボタンをクリック\n\nCSVファイル不要で、概算の確定申告額を確認できます。',
        keywords: ['シミュレーター', '使い方', 'コピペ', 'ペースト', '計算']
    },
    {
        id: 'feature-portfolio-1',
        category: 'ポートフォリオ',
        question: 'ポートフォリオ分析とは？',
        answer: '【Beta版機能】\n\n保有銘柄の資産配分を円グラフで可視化し、理想的なリバランス案を提案する機能です。\n\n使い方:\n1. Firstradeの保有銘柄画面をコピー\n2. ポートフォリオページにペースト\n3. 現在の配分と目標配分が表示されます\n\nCSVファイル不要で手軽に分析できます。',
        keywords: ['ポートフォリオ', '分析', '配分', 'リバランス', 'Beta']
    },

    // ========================================
    // カテゴリ: エクスポート
    // ========================================
    {
        id: 'export-1',
        category: 'エクスポート',
        question: 'CSVエクスポートの方法は？',
        answer: 'データ表示後、画面右上の「CSVエクスポート」ボタンをクリックしてください。\n\n日付入りのファイル名で自動ダウンロードされます。\n\n注意: CSVエクスポートは有料ライセンス機能です。',
        keywords: ['エクスポート', 'ダウンロード', 'CSV', '出力', '保存']
    },
    {
        id: 'export-2',
        category: 'エクスポート',
        question: 'エクスポートしたファイルは何に使えますか？',
        answer: 'エクスポートしたCSVファイルは以下に活用できます：\n\n1. 確定申告書の作成: データを参照しながら申告書に転記\n2. 税理士への提出: そのまま資料として提出\n3. 記録保管: 年度ごとの取引記録として保管\n\n※e-Taxへの直接インポートには対応していません。',
        keywords: ['使い方', '活用', '確定申告', 'e-Tax', '税理士']
    },

    // ========================================
    // カテゴリ: トラブルシューティング
    // ========================================
    {
        id: 'trouble-1',
        category: 'トラブル',
        question: '画面が真っ白になりました',
        answer: '以下をお試しください：\n\n1. ブラウザをリロード: F5キー または ⌘+R\n2. キャッシュクリア: ブラウザの設定からキャッシュを削除\n3. 別ブラウザで試す: Chrome, Firefox, Edge などの最新版を推奨\n\n解決しない場合は、お問い合わせください。',
        keywords: ['真っ白', '表示されない', '動かない', 'エラー', '画面']
    },
    {
        id: 'trouble-2',
        category: 'トラブル',
        question: 'データをリセットしたい',
        answer: '各機能ページに「入力データをリセット」ボタンがあります。\n\nこのボタンをクリックすると、アップロードしたデータがクリアされ、最初からやり直せます。\n\n※ブラウザのローカルストレージに保存されたデータも削除されます。',
        keywords: ['リセット', 'クリア', '削除', 'やり直し', '最初から']
    },
    {
        id: 'trouble-3',
        category: 'トラブル',
        question: '計算結果がおかしい気がします',
        answer: '以下を確認してください：\n\n1. CSVファイル: Firstradeからダウンロードした元ファイルを使用していますか？\n2. 年度: 正しい年度のCSVをアップロードしていますか？\n3. 為替レート警告: デフォルトレートが使用されていませんか？\n\n不明な点があれば、お問い合わせからご連絡ください。',
        keywords: ['おかしい', '間違い', '計算', '結果', '正しくない']
    },

    // ========================================
    // カテゴリ: その他
    // ========================================
    {
        id: 'other-1',
        category: 'その他',
        question: '確定申告の方法を教えてください',
        answer: '申し訳ございませんが、税務に関する個別のアドバイスは税理士法により禁止されています。\n\n確定申告の具体的な方法については、以下をご参照ください：\n\n- 国税庁のウェブサイト\n- お住まいの税務署\n- 税理士への相談\n\n当ツールは「データの円換算と集計」に特化しています。',
        keywords: ['確定申告', '方法', 'やり方', 'e-Tax', '税務署', 'アドバイス']
    },
    {
        id: 'other-2',
        category: 'その他',
        question: 'このツールは公式ですか？',
        answer: 'いいえ、FirstScope は個人開発者による非公式ツールです。\n\nFirstrade証券とは無関係です。\n\n確定申告の内容については、必ずご自身または税理士にご確認ください。',
        keywords: ['公式', '非公式', 'Firstrade', '関係']
    },
    {
        id: 'other-3',
        category: 'その他',
        question: 'お問い合わせ方法は？',
        answer: 'ページ下部のフッターにある「お問い合わせ」リンクから、Notionフォームにアクセスできます。\n\n以下の内容をお送りいただくとスムーズです：\n\n- 発生した問題の詳細\n- お使いのブラウザとOS\n- エラーメッセージ（あれば）\n- スクリーンショット（あれば）',
        keywords: ['問い合わせ', '連絡', 'サポート', 'ヘルプ', 'メール']
    }
];

// カテゴリ一覧を取得
export const FAQ_CATEGORIES = [...new Set(FAQ_DATA.map(item => item.category))];

// サジェスト表示用の人気質問
export const POPULAR_QUESTIONS = [
    'getting-started-1', // このツールは何ができますか？
    'csv-1',            // CSVファイルはどこからダウンロードできますか？
    'license-1',        // ライセンスの価格と有効期限は？
    'getting-started-2', // 無料で使える機能はありますか？
];

// キーワード検索
export function searchFAQ(query: string): FAQItem[] {
    if (!query.trim()) return [];

    const normalizedQuery = query.toLowerCase();

    return FAQ_DATA.filter(item => {
        // 質問文に含まれているか
        if (item.question.toLowerCase().includes(normalizedQuery)) return true;
        // 回答文に含まれているか
        if (item.answer.toLowerCase().includes(normalizedQuery)) return true;
        // キーワードに含まれているか
        if (item.keywords.some(kw => kw.toLowerCase().includes(normalizedQuery))) return true;
        return false;
    }).slice(0, 5); // 最大5件
}
